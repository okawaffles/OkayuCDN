function sendFiles(e){$("p.upload_error").css("display","none"),resetProgressBar();var n=new XMLHttpRequest;n.upload.addEventListener("progress",updateProgress),n.open("POST","/api/upload");for(var t=new FormData,s=0;s<e.length;s++)if(navigator.userAgent.includes("Android")){let n=e[s].name.split("."),o=n.length-1;t.append("file"+s,e[s],document.getElementById("filename").value+"."+n[o]),endFileName=document.getElementById("filename").value+"."+n[o]}else t.append("file"+s,e[s],document.getElementById("filename").value+"."+e[s].name.split(".").at(-1)),endFileName=document.getElementById("filename").value+"."+e[s].name.split(".").at(-1);n.send(t)}function checkResult(){$.getJSON(`/api/getres?user=${endUserName}&service=uus`,function(e){console.log("data: "+JSON.stringify(e));let n=e.success;n?(progress.innerHTML="<br><p>Finished, please wait...</p>",console.log(`ok: ${e.toString()}`),document.location=`/success?f=${endFileName}`):"SCH-RNF"!=e.code?($("p.upload_error").html(`An error has occurred while uploading.\nDetails: ${e.details} (${e.code})`),$("p.upload_error").css("color","red"),$("#visibleToggle").css("display","none"),console.log(`error: ${e.code}`)):setTimeout(()=>{checkResult()},2500)})}function updateProgress(e){if(console.log(e.loaded/e.total*100+"%"),progress.style.width=e.loaded/e.total*100+"%","100%"==progress.style.width){$("#visibleToggle").css("display","inline"),$("p.upload_error").html("Processing your file, please wait a moment..."),$("p.upload_error").css("color","white"),$("p.upload_error").css("display","inline");setTimeout(()=>{checkResult()},2500)}}function resetProgressBar(){progress.innerHTML="",progress.style.width="0%"}function addProgressBar(){var e=document.createElement("div");e.className="progressBar",progressUpload.appendChild(e);var n=document.createElement("div");n.className="up_progress",e.appendChild(n),progress=document.getElementsByClassName("up_progress")[0]}function assignUserName(e,n,t){endUserName=e,"true"==t&&(document.getElementById("premium-tag").style.display="inline"),"true"==n&&(document.getElementById("banner-hider").style="",document.getElementById("banner-contents").innerHTML=`Hey ${e}! You seem to be a bug-tester! Thanks for your help! We've upped your storage as a thank-you!`,document.getElementById("bugtest-tag").style.display="inline");let s="DoNotDisplay";navigator.userAgent.includes("Firefox")||(s="Warning: Your browser doesn't seem to be Firefox-based. Please note that this site is maintained based off of Firefox. Please report any bugs on the GitHub (okawaffles/OkayuCDN)!"),(navigator.userAgent.includes("iPhone OS")||navigator.userAgent.includes("iPad OS"))&&(s="Warning: You appear to be using an Apple device. You likely cannot upload due to a WebKit bug."),navigator.userAgent.includes("CrOS")&&(s="Warning: You appear to be using a ChromeOS device. This operating system sometimes doesn't work as expected."),navigator.userAgent.includes("Symbian")&&(s="Warning: You appear to be using a Symbian device. This operating system is not supported."),navigator.userAgent.includes("Fire OS")&&(s="Warning: You appear to be using a Fire OS device. This device is untested. Please report bugs on the GitHub page."),(navigator.userAgent.includes("Roku")||navigator.userAgent.includes("SMART-TV")||navigator.userAgent.includes("Web0S"))&&(s="Warning: You appear to be using a TV device. This device is not supported."),(navigator.userAgent.includes("PlayStation")||navigator.userAgent.includes("Xbox")||navigator.userAgent.includes("PLAYSTATION")||navigator.userAgent.includes("Nintendo Wii"))&&(s="Warning: You are using a game console. This device is not supported."),"DoNotDisplay"!=s&&($("#banner-ua-notice").css("display","inline"),$("#ua-warning-contents").html(s))}function getStorage(){document.getElementById("visibleToggle").style="display: inline;",$.getJSON(`/api/qus?user=${endUserName}`,function(e){document.getElementById("storageAmount").innerHTML=document.cookie.includes("language=ja-jp")?`保存：${e.userTS/1024/1024/1024}GBのうちの${(e.size/1024/1024/1024).toFixed(2)}GB`:`You have used ${(e.size/1024/1024/1024).toFixed(2)}GB of storage (of your ${e.userTS/1024/1024/1024}GB)`,document.getElementById("storageAmount").style="",document.getElementById("visibleToggle").style="display: none;",e.size<e.userTS?document.getElementById("hider").style="":alert(document.cookie.includes("language=ja-jp")?"あなたは保存を有しません。":"You seem to have run out of storage! Please use the My Box page to remove content before continuing.")})}var progress,endFileName,endUserName,browse=document.getElementsByClassName("chooseFiles")[0],selectDialog=document.getElementById("uploaded"),progressUpload=document.getElementById("progressUpload");addProgressBar(),browse.addEventListener("click",function(){selectDialog.click()});try{document.getElementById("uploadBtn").onclick=function(){/^([a-zA-Z0-9_-]{1,50})$/.test(document.getElementById("filename").value)?sendFiles(selectDialog.files):($("p.upload_error").html("Error: File name is not valid."),$("p.upload_error").css("display","inline"))}}catch(e){alert("Error in uploadscript.js"),console.log(e)}console.log("loaded uploadscript.js");