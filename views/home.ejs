<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Welcome to OkayuCDN!</title>
        <link rel="stylesheet" href="/assets/styles/_newStyles.css">
        <script src="https://kit.fontawesome.com/dc1b60441b.js" crossorigin="anonymous"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
        <script src="/assets/scripts/accessibility.js"></script>

        <meta property="og:title" content="Home - OkayuCDN" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://okayu.okawaffles.com" />
        <!-- <meta property="og:image" content="https://okayu.okawaffles.com/assets/images/thumbnail.png" /> -->
        <meta property="og:description" content="Upload files for free" />
        <meta name="theme-color" content="#9a21db">
    </head>
    <body>
        <%- include('parts/navbar', {active:'home'}) %>
        <div id="announcement">
            <p id="announcement-content">This is where an announcement would go.</p>
        </div>

        <div class="container">
            <h1 class="title" id="t_title __LANG_WELCOME">Welcome to OkayuCDN!</h1>
            <h2 class="subtitle sa" id="t_sa __LANG_SUB_A">You can upload your files for free here!</h2>
            <h2 class="subtitle sb" id="t_sb __LANG_SUB_B">These files can then be shared and embedded anywhere!</h2>
        </div>

        <div class="characters">
            <img src="./assets/images/okayu_450.png" id="okayu" class="chara-center" />
        </div>

        <!-- <div class="home">
            <h1>Welcome to OkayuCDN!</h1>
        </div> -->

        <h3 class="v" id="ver">v<%= version %>
        </h3><br>
    </body>

<script>
    $.getJSON('/api/health', (data) => {
        const announcement = data.config.announcement;
        if (announcement.active) {
            $('#announcement').css('display', 'inherit');
            $('#announcement-content').html(announcement.content);
        }
    });

    $('#ver').click(() => {
        let version = $('#ver').text();
        if (!version.includes('(')) return;
        
        let commitId = version.split('(')[1].split(')')[0];

        document.location = `https://github.com/okawaffles/OkayuCDN/commit/${commitId}`;
    });

    // silly idea by kasatka, thanks :3
    const must_match = [
        'ArrowUp',
        'ArrowUp',
        'ArrowDown',
        'ArrowDown',
        'ArrowLeft',
        'ArrowRight',
        'ArrowLeft',
        'ArrowRight',
        'b','a',
        'Enter'
    ];

    const current_history = [];
    let is_listening = true;

    document.onkeydown = (event) => {
        if (!is_listening) return;

        console.log(event.key);
        if (current_history.length >= must_match.length) current_history.shift();

        current_history.push(event.key);

        if (event.key == 'ArrowUp') {
            $('#okayu').css('animation', 'none');
            $('#okayu').css('bottom', '1rem');
            setTimeout(() => {
                $('#okayu').css('bottom', '0');
            }, 100);
        }
        if (event.key == 'ArrowDown') {
            $('#okayu').css('animation', 'none');
            $('#okayu').css('bottom', '-1rem');
            setTimeout(() => {
                $('#okayu').css('bottom', '0');
            }, 100);
        }
        if (event.key == 'ArrowLeft') {
            $('#okayu').css('left', '48%');
            setTimeout(() => {
                $('#okayu').css('left', '50%');
            }, 100);
        }
        if (event.key == 'ArrowRight') {
            $('#okayu').css('left', '52%');
            setTimeout(() => {
                $('#okayu').css('left', '50%');
            }, 100);
        }
        if (event.key == 'b' || event.key == 'a' || event.key == 'Enter') {
            $('#okayu').css('height', '5rem');
            $('#okayu').css('width', '25rem');
            setTimeout(() => {
                $('#okayu').css('height', 'revert');
            }, 100);
        }

        if (current_history.join(',') == must_match.join(',')) {
            console.log('PANPAKAPAN ACTIVATED');
            is_listening = false;

            const music = new Audio('/assets/panpakapan/unwelcomeschool.mp3');
            const panpakapan = new Audio('/assets/panpakapan/panpakapan.mp3');

            panpakapan.play();
            setTimeout(() => {
                $('#okayu').prop('src', '/assets/panpakapan/arisdance.gif');
                document.getElementsByTagName('body')[0].style.backgroundColor = '#36373c';
                music.volume = .5;
                music.play();
            }, 1000);
        }
    };
</script>

</html>